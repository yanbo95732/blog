import{an as _e,ao as Z,$ as p,Z as x,ap as R,aq as Ee,ar as ce,B as Ae,t as A,as as De,am as re,a as b,af as ue,V as U,q as j,ai as de,f as i,at as fe,au as ve,a2 as D,av as ze,aw as W,S as me,ax as ye,a1 as V,aj as T,c as Le,E as Ne,ay as ge,b as he,az as Re,p as Me,aA as $e,F as we,a7 as M,aB as Ke,a9 as Ce,o as He,aC as ke,ak as Fe,aD as be,aE as Ue,r as Be,aF as je,aG as Ve,aH as qe,X as Ge,aI as Ye,aJ as J,aK as Ze,Y as Je,aL as ee,aM as We,O as Xe,g as G,d as Qe,e as Y,x as en,w as _,H as ne,h as z,K as nn,L as te}from"./index-CiKZm7CY.js";import{u as tn}from"./use-touch-K7zSc3pH.js";function Oe(e,{args:n=[],done:t,canceled:l,error:o}){if(e){const s=e.apply(null,n);_e(s)?s.then(c=>{c?t():l&&l()}).catch(o||Z):s?t():l&&l()}else t()}let on=2e3;const an=()=>++on,X={show:Boolean,zIndex:p,overlay:x,duration:p,teleport:[String,Object],lockScroll:x,lazyRender:x,beforeClose:Function,overlayStyle:Object,overlayClass:R,transitionAppear:Boolean,closeOnClickOverlay:x},ln=Object.keys(X);let L=0;const oe="van-overflow-hidden";function sn(e,n){const t=tn(),l="01",o="10",s=w=>{t.move(w);const f=t.deltaY.value>0?o:l,y=De(w.target,e.value),{scrollHeight:u,offsetHeight:a,scrollTop:k}=y;let g="11";k===0?g=a>=u?"00":"01":k+a>=u&&(g="10"),g!=="11"&&t.isVertical()&&!(parseInt(g,2)&parseInt(f,2))&&re(w,!0)},c=()=>{document.addEventListener("touchstart",t.start),document.addEventListener("touchmove",s,{passive:!1}),L||document.body.classList.add(oe),L++},v=()=>{L&&(document.removeEventListener("touchstart",t.start),document.removeEventListener("touchmove",s),L--,L||document.body.classList.remove(oe))},C=()=>n()&&c(),h=()=>n()&&v();Ee(C),ce(h),Ae(h),A(n,w=>{w?c():v()})}function Se(e){const n=b(!1);return A(e,t=>{t&&(n.value=t)},{immediate:!0}),t=>()=>n.value?t():null}const ae=()=>{var e;const{scopeId:n}=((e=ue())==null?void 0:e.vnode)||{};return n?{[n]:""}:null},[cn,rn]=U("overlay"),un={show:Boolean,zIndex:p,duration:p,className:R,lockScroll:x,lazyRender:x,customStyle:Object,teleport:[String,Object]};var dn=j({name:cn,props:un,setup(e,{slots:n}){const t=b(),l=Se(()=>e.show||!e.lazyRender),o=c=>{e.lockScroll&&re(c,!0)},s=l(()=>{var c;const v=D(ze(e.zIndex),e.customStyle);return W(e.duration)&&(v.animationDuration=`${e.duration}s`),me(i("div",{ref:t,style:v,class:[rn(),e.className]},[(c=n.default)==null?void 0:c.call(n)]),[[ye,e.show]])});return de("touchmove",o,{target:t}),()=>{const c=i(fe,{name:"van-fade",appear:!0},{default:s});return e.teleport?i(ve,{to:e.teleport},{default:()=>[c]}):c}}});const fn=V(dn),vn=D({},X,{round:Boolean,position:T("center"),closeIcon:T("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:T("top-right"),destroyOnClose:Boolean,safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[mn,le]=U("popup");var yn=j({name:mn,inheritAttrs:!1,props:vn,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:n,attrs:t,slots:l}){let o,s;const c=b(),v=b(),C=Se(()=>e.show||!e.lazyRender),h=Le(()=>{const d={zIndex:c.value};if(W(e.duration)){const I=e.position==="center"?"animationDuration":"transitionDuration";d[I]=`${e.duration}s`}return d}),w=()=>{o||(o=!0,c.value=e.zIndex!==void 0?+e.zIndex:an(),n("open"))},f=()=>{o&&Oe(e.beforeClose,{done(){o=!1,n("close"),n("update:show",!1)}})},y=d=>{n("clickOverlay",d),e.closeOnClickOverlay&&f()},u=()=>{if(e.overlay)return i(fn,M({show:e.show,class:e.overlayClass,zIndex:c.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},ae(),{onClick:y}),{default:l["overlay-content"]})},a=d=>{n("clickCloseIcon",d),f()},k=()=>{if(e.closeable)return i(Ce,{role:"button",tabindex:0,name:e.closeIcon,class:[le("close-icon",e.closeIconPosition),Ke],classPrefix:e.iconPrefix,onClick:a},null)};let g;const r=()=>{g&&clearTimeout(g),g=setTimeout(()=>{n("opened")})},m=()=>n("closed"),O=d=>n("keydown",d),S=C(()=>{var d;const{destroyOnClose:I,round:q,position:$,safeAreaInsetTop:Pe,safeAreaInsetBottom:Te,show:Q}=e;if(!(!Q&&I))return me(i("div",M({ref:v,style:h.value,role:"dialog",tabindex:0,class:[le({round:q,[$]:$}),{"van-safe-area-top":Pe,"van-safe-area-bottom":Te}],onKeydown:O},t,ae()),[(d=l.default)==null?void 0:d.call(l),k()]),[[ye,Q]])}),P=()=>{const{position:d,transition:I,transitionAppear:q}=e,$=d==="center"?"van-fade":`van-popup-slide-${d}`;return i(fe,{name:I||$,appear:q,onAfterEnter:r,onAfterLeave:m},{default:S})};return A(()=>e.show,d=>{d&&!o&&(w(),t.tabindex===0&&Ne(()=>{var I;(I=v.value)==null||I.focus()})),!d&&o&&(o=!1,n("close"))}),ge({popupRef:v}),sn(v,()=>e.show&&e.lockScroll),de("popstate",()=>{e.closeOnPopstate&&(f(),s=!1)}),he(()=>{e.show&&w()}),Re(()=>{s&&(n("update:show",!0),s=!1)}),ce(()=>{e.show&&e.teleport&&(f(),s=!0)}),Me($e,()=>e.show),()=>e.teleport?i(ve,{to:e.teleport},{default:()=>[u(),P()]}):i(we,null,[u(),P()])}});const xe=V(yn);let N=0;function gn(e){e?(N||document.body.classList.add("van-toast--unclickable"),N++):N&&(N--,N||document.body.classList.remove("van-toast--unclickable"))}const[hn,E]=U("toast"),wn=["show","overlay","teleport","transition","overlayClass","overlayStyle","closeOnClickOverlay","zIndex"],Cn={icon:String,show:Boolean,type:T("text"),overlay:Boolean,message:p,iconSize:p,duration:Fe(2e3),position:T("middle"),teleport:[String,Object],wordBreak:String,className:R,iconPrefix:String,transition:T("van-fade"),loadingType:String,forbidClick:Boolean,overlayClass:R,overlayStyle:Object,closeOnClick:Boolean,closeOnClickOverlay:Boolean,zIndex:p};var Ie=j({name:hn,props:Cn,emits:["update:show"],setup(e,{emit:n,slots:t}){let l,o=!1;const s=()=>{const f=e.show&&e.forbidClick;o!==f&&(o=f,gn(o))},c=f=>n("update:show",f),v=()=>{e.closeOnClick&&c(!1)},C=()=>clearTimeout(l),h=()=>{const{icon:f,type:y,iconSize:u,iconPrefix:a,loadingType:k}=e;if(f||y==="success"||y==="fail")return i(Ce,{name:f||y,size:u,class:E("icon"),classPrefix:a},null);if(y==="loading")return i(be,{class:E("loading"),size:u,type:k},null)},w=()=>{const{type:f,message:y}=e;if(t.message)return i("div",{class:E("text")},[t.message()]);if(W(y)&&y!=="")return f==="html"?i("div",{key:0,class:E("text"),innerHTML:String(y)},null):i("div",{class:E("text")},[y])};return A(()=>[e.show,e.forbidClick],s),A(()=>[e.show,e.type,e.message,e.duration],()=>{C(),e.show&&e.duration>0&&(l=setTimeout(()=>{c(!1)},e.duration))}),he(s),He(s),()=>i(xe,M({class:[E([e.position,e.wordBreak==="normal"?"break-normal":e.wordBreak,{[e.type]:!e.icon}]),e.className],lockScroll:!1,onClick:v,onClosed:C,"onUpdate:show":c},ke(e,wn)),{default:()=>[h(),w()]})}});function kn(){const e=Be({show:!1}),n=o=>{e.show=o},t=o=>{D(e,o,{transitionAppear:!0}),n(!0)},l=()=>n(!1);return ge({open:t,close:l,toggle:n}),{open:t,close:l,state:e,toggle:n}}function bn(e){const n=Ue(e),t=document.createElement("div");return document.body.appendChild(t),{instance:n.mount(t),unmount(){n.unmount(),document.body.removeChild(t)}}}const Bn={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let K=[],On=!1,se=D({},Bn);const Sn=new Map;function xn(e){return Ve(e)?e:{message:e}}function In(){const{instance:e,unmount:n}=bn({setup(){const t=b(""),{open:l,state:o,close:s,toggle:c}=kn(),v=()=>{},C=()=>i(Ie,M(o,{onClosed:v,"onUpdate:show":c}),null);return A(t,h=>{o.message=h}),ue().render=C,{open:l,close:s,message:t}}});return e}function pn(){if(!K.length||On){const e=In();K.push(e)}return K[K.length-1]}function H(e={}){if(!je)return{};const n=pn(),t=xn(e);return n.open(D({},se,Sn.get(t.type||se.type),t)),n}V(Ie);const[Pn,B,F]=U("dialog"),Tn=D({},X,{title:String,theme:String,width:p,message:[String,Function],callback:Function,allowHtml:Boolean,className:R,transition:T("van-dialog-bounce"),messageAlign:String,closeOnPopstate:x,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:x,closeOnClickOverlay:Boolean,keyboardEnabled:x}),_n=[...ln,"transition","closeOnPopstate"];var En=j({name:Pn,props:Tn,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:n,slots:t}){const l=b(),o=Be({confirm:!1,cancel:!1}),s=r=>n("update:show",r),c=r=>{var m;s(!1),(m=e.callback)==null||m.call(e,r)},v=r=>()=>{e.show&&(n(r),e.beforeClose?(o[r]=!0,Oe(e.beforeClose,{args:[r],done(){c(r),o[r]=!1},canceled(){o[r]=!1}})):c(r))},C=v("cancel"),h=v("confirm"),w=qe(r=>{var m,O;if(!e.keyboardEnabled||r.target!==((O=(m=l.value)==null?void 0:m.popupRef)==null?void 0:O.value))return;({Enter:e.showConfirmButton?h:Z,Escape:e.showCancelButton?C:Z})[r.key](),n("keydown",r)},["enter","esc"]),f=()=>{const r=t.title?t.title():e.title;if(r)return i("div",{class:B("header",{isolated:!e.message&&!t.default})},[r])},y=r=>{const{message:m,allowHtml:O,messageAlign:S}=e,P=B("message",{"has-title":r,[S]:S}),d=Ye(m)?m():m;return O&&typeof d=="string"?i("div",{class:P,innerHTML:d},null):i("div",{class:P},[d])},u=()=>{if(t.default)return i("div",{class:B("content")},[t.default()]);const{title:r,message:m,allowHtml:O}=e;if(m){const S=!!(r||t.title);return i("div",{key:O?1:0,class:B("content",{isolated:!S})},[y(S)])}},a=()=>i("div",{class:[Je,B("footer")]},[e.showCancelButton&&i(J,{size:"large",text:e.cancelButtonText||F("cancel"),class:B("cancel"),style:{color:e.cancelButtonColor},loading:o.cancel,disabled:e.cancelButtonDisabled,onClick:C},null),e.showConfirmButton&&i(J,{size:"large",text:e.confirmButtonText||F("confirm"),class:[B("confirm"),{[Ze]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:o.confirm,disabled:e.confirmButtonDisabled,onClick:h},null)]),k=()=>i(We,{class:B("footer")},{default:()=>[e.showCancelButton&&i(ee,{type:"warning",text:e.cancelButtonText||F("cancel"),class:B("cancel"),color:e.cancelButtonColor,loading:o.cancel,disabled:e.cancelButtonDisabled,onClick:C},null),e.showConfirmButton&&i(ee,{type:"danger",text:e.confirmButtonText||F("confirm"),class:B("confirm"),color:e.confirmButtonColor,loading:o.confirm,disabled:e.confirmButtonDisabled,onClick:h},null)]}),g=()=>t.footer?t.footer():e.theme==="round-button"?k():a();return()=>{const{width:r,title:m,theme:O,message:S,className:P}=e;return i(xe,M({ref:l,role:"dialog",class:[B([O]),P],style:{width:Ge(r)},tabindex:0,"aria-labelledby":m||S,onKeydown:w,"onUpdate:show":s},ke(e,_n)),{default:()=>[f(),u(),g()]})}}});const An=V(En);async function pe(e,n={},t){return window.__TAURI_INTERNALS__.invoke(e,n,t)}async function Dn(e){return await pe("plugin:update|install",{payload:{value:e}}).then(n=>n.value?n.value:null)}async function ie(e,n,t){return await pe("plugin:update|download",{payload:{url:e,name:n,external:t}}).then(l=>({message:l.message,filePath:l.filePath}))}const zn=["href"],Ln={style:{width:"100%"}},Nn={__name:"DownloadLink",props:{href:{type:String,required:!0},download:{type:Boolean,default:!0}},setup(e){const n=b(!1),t=e,l=b(""),o=b(""),s=b(!1),c=b("下载中..."),v=b(t.href.endsWith(".apk")),C=b(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),h=u=>{location.search.indexOf("tauri")>-1&&C.value&&(console.log("点击",u.target.href),t.download&&(u.preventDefault(),l.value=u.target.href,o.value=u.target.href.split("/").pop(),n.value=!0))},w=u=>{s.value=!0,console.log("下载 ",l.value,o.value,u),ie(l.value,o.value,u).then(a=>{console.log("下载结果",JSON.stringify(a)),s.value=!1,H("下载成功")}).catch(a=>{s.value=!1,console.log("下载失败",a),H("下载失败")}),n.value=!1},f=()=>{n.value=!1},y=()=>{console.log("下载并安装",l.value,o.value);let u="false";s.value=!0,console.log("下载 ",l.value,o.value,u),ie(l.value,o.value,u).then(a=>{console.log("下载结果",a),a.filePath?(c.value="安装中...",Dn(a.filePath).then(k=>{console.log("安装结果",k),s.value=!1}).catch(k=>{console.log("安装失败",k),s.value=!1,H("安装失败")})):(console.log("下载成功",a),s.value=!1,H("下载成功"))}).catch(a=>{console.log("下载失败",a),s.value=!1})};return(u,a)=>{const k=be,g=J,r=An;return G(),Qe(we,null,[Y("a",{href:e.href,onClick:h,class:"download-link"},[en(u.$slots,"default",{},void 0,!0)],8,zn),i(r,{show:n.value,"onUpdate:show":a[2]||(a[2]=m=>n.value=m),title:"下载文件","show-cancel-button":!1,"show-confirm-button":!1},{default:_(()=>[Y("div",Ln,[a[7]||(a[7]=Y("p",null,"选择下载到内部还是外部？",-1)),s.value?(G(),ne(k,{key:0,size:"24px",vertical:""},{default:_(()=>[z(nn(c.value),1)]),_:1})):te("",!0),i(g,{type:"primary",onClick:a[0]||(a[0]=m=>w("false"))},{default:_(()=>a[3]||(a[3]=[z("内部")])),_:1}),i(g,{type:"primary",onClick:a[1]||(a[1]=m=>w("true"))},{default:_(()=>a[4]||(a[4]=[z("外部")])),_:1}),v.value?(G(),ne(g,{key:1,type:"primary",onClick:y},{default:_(()=>a[5]||(a[5]=[z("下载并安装")])),_:1})):te("",!0),i(g,{type:"default",onClick:f},{default:_(()=>a[6]||(a[6]=[z("取消")])),_:1})])]),_:1},8,["show"])],64)}}},$n=Xe(Nn,[["__scopeId","data-v-499e2181"]]);export{$n as _};
