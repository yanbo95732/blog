import{ag as Ee,ah as G,$ as p,Z as I,ai as R,a as m,aj as ee,ak as Ae,al as re,B as De,t as A,am as ze,an as ue,af as de,V as U,q as j,ao as fe,f as i,ap as ve,aq as me,a2 as D,ar as Le,as as J,S as ye,at as he,a1 as V,au as T,c as Ne,E as Re,av as ge,b as we,aw as Me,p as $e,ax as Ke,F as Ce,a7 as M,ay as Fe,a9 as ke,o as He,az as be,aA as Ue,aB as Be,aC as je,r as Oe,aD as Ve,aE as Ye,aF as Xe,X as qe,aG as Ge,aH as Z,aI as Ze,Y as Je,aJ as te,aK as We,O as Qe,g as X,d as et,e as q,x as tt,w as _,H as ne,h as z,K as nt,L as oe}from"./index-BeEkCUdZ.js";function Se(e,{args:t=[],done:n,canceled:s,error:o}){if(e){const l=e.apply(null,t);Ee(l)?l.then(c=>{c?n():s&&s()}).catch(o||G):l?n():s&&s()}else n()}let ot=2e3;const at=()=>++ot,W={show:Boolean,zIndex:p,overlay:I,duration:p,teleport:[String,Object],lockScroll:I,lazyRender:I,beforeClose:Function,overlayStyle:Object,overlayClass:R,transitionAppear:Boolean,closeOnClickOverlay:I},lt=Object.keys(W);function st(e,t){return e>t?"horizontal":t>e?"vertical":""}function ct(){const e=m(0),t=m(0),n=m(0),s=m(0),o=m(0),l=m(0),c=m(""),d=m(!0),k=()=>c.value==="vertical",w=()=>c.value==="horizontal",h=()=>{n.value=0,s.value=0,o.value=0,l.value=0,c.value="",d.value=!0};return{move:r=>{const a=r.touches[0];n.value=(a.clientX<0?0:a.clientX)-e.value,s.value=a.clientY-t.value,o.value=Math.abs(n.value),l.value=Math.abs(s.value);const C=10;(!c.value||o.value<C&&l.value<C)&&(c.value=st(o.value,l.value)),d.value&&(o.value>ee||l.value>ee)&&(d.value=!1)},start:r=>{h(),e.value=r.touches[0].clientX,t.value=r.touches[0].clientY},reset:h,startX:e,startY:t,deltaX:n,deltaY:s,offsetX:o,offsetY:l,direction:c,isVertical:k,isHorizontal:w,isTap:d}}let L=0;const ae="van-overflow-hidden";function it(e,t){const n=ct(),s="01",o="10",l=h=>{n.move(h);const f=n.deltaY.value>0?o:s,g=ze(h.target,e.value),{scrollHeight:r,offsetHeight:a,scrollTop:C}=g;let b="11";C===0?b=a>=r?"00":"01":C+a>=r&&(b="10"),b!=="11"&&n.isVertical()&&!(parseInt(b,2)&parseInt(f,2))&&ue(h,!0)},c=()=>{document.addEventListener("touchstart",n.start),document.addEventListener("touchmove",l,{passive:!1}),L||document.body.classList.add(ae),L++},d=()=>{L&&(document.removeEventListener("touchstart",n.start),document.removeEventListener("touchmove",l),L--,L||document.body.classList.remove(ae))},k=()=>t()&&c(),w=()=>t()&&d();Ae(k),re(w),De(w),A(t,h=>{h?c():d()})}function Ie(e){const t=m(!1);return A(e,n=>{n&&(t.value=n)},{immediate:!0}),n=>()=>t.value?n():null}const le=()=>{var e;const{scopeId:t}=((e=de())==null?void 0:e.vnode)||{};return t?{[t]:""}:null},[rt,ut]=U("overlay"),dt={show:Boolean,zIndex:p,duration:p,className:R,lockScroll:I,lazyRender:I,customStyle:Object,teleport:[String,Object]};var ft=j({name:rt,props:dt,setup(e,{slots:t}){const n=m(),s=Ie(()=>e.show||!e.lazyRender),o=c=>{e.lockScroll&&ue(c,!0)},l=s(()=>{var c;const d=D(Le(e.zIndex),e.customStyle);return J(e.duration)&&(d.animationDuration=`${e.duration}s`),ye(i("div",{ref:n,style:d,class:[ut(),e.className]},[(c=t.default)==null?void 0:c.call(t)]),[[he,e.show]])});return fe("touchmove",o,{target:n}),()=>{const c=i(ve,{name:"van-fade",appear:!0},{default:l});return e.teleport?i(me,{to:e.teleport},{default:()=>[c]}):c}}});const vt=V(ft),mt=D({},W,{round:Boolean,position:T("center"),closeIcon:T("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:T("top-right"),destroyOnClose:Boolean,safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[yt,se]=U("popup");var ht=j({name:yt,inheritAttrs:!1,props:mt,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:t,attrs:n,slots:s}){let o,l;const c=m(),d=m(),k=Ie(()=>e.show||!e.lazyRender),w=Ne(()=>{const v={zIndex:c.value};if(J(e.duration)){const x=e.position==="center"?"animationDuration":"transitionDuration";v[x]=`${e.duration}s`}return v}),h=()=>{o||(o=!0,c.value=e.zIndex!==void 0?+e.zIndex:at(),t("open"))},f=()=>{o&&Se(e.beforeClose,{done(){o=!1,t("close"),t("update:show",!1)}})},g=v=>{t("clickOverlay",v),e.closeOnClickOverlay&&f()},r=()=>{if(e.overlay)return i(vt,M({show:e.show,class:e.overlayClass,zIndex:c.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},le(),{onClick:g}),{default:s["overlay-content"]})},a=v=>{t("clickCloseIcon",v),f()},C=()=>{if(e.closeable)return i(ke,{role:"button",tabindex:0,name:e.closeIcon,class:[se("close-icon",e.closeIconPosition),Fe],classPrefix:e.iconPrefix,onClick:a},null)};let b;const u=()=>{b&&clearTimeout(b),b=setTimeout(()=>{t("opened")})},y=()=>t("closed"),O=v=>t("keydown",v),S=k(()=>{var v;const{destroyOnClose:x,round:Y,position:$,safeAreaInsetTop:Te,safeAreaInsetBottom:_e,show:Q}=e;if(!(!Q&&x))return ye(i("div",M({ref:d,style:w.value,role:"dialog",tabindex:0,class:[se({round:Y,[$]:$}),{"van-safe-area-top":Te,"van-safe-area-bottom":_e}],onKeydown:O},n,le()),[(v=s.default)==null?void 0:v.call(s),C()]),[[he,Q]])}),P=()=>{const{position:v,transition:x,transitionAppear:Y}=e,$=v==="center"?"van-fade":`van-popup-slide-${v}`;return i(ve,{name:x||$,appear:Y,onAfterEnter:u,onAfterLeave:y},{default:S})};return A(()=>e.show,v=>{v&&!o&&(h(),n.tabindex===0&&Re(()=>{var x;(x=d.value)==null||x.focus()})),!v&&o&&(o=!1,t("close"))}),ge({popupRef:d}),it(d,()=>e.show&&e.lockScroll),fe("popstate",()=>{e.closeOnPopstate&&(f(),l=!1)}),we(()=>{e.show&&h()}),Me(()=>{l&&(t("update:show",!0),l=!1)}),re(()=>{e.show&&e.teleport&&(f(),l=!0)}),$e(Ke,()=>e.show),()=>e.teleport?i(me,{to:e.teleport},{default:()=>[r(),P()]}):i(Ce,null,[r(),P()])}});const xe=V(ht);let N=0;function gt(e){e?(N||document.body.classList.add("van-toast--unclickable"),N++):N&&(N--,N||document.body.classList.remove("van-toast--unclickable"))}const[wt,E]=U("toast"),Ct=["show","overlay","teleport","transition","overlayClass","overlayStyle","closeOnClickOverlay","zIndex"],kt={icon:String,show:Boolean,type:T("text"),overlay:Boolean,message:p,iconSize:p,duration:Ue(2e3),position:T("middle"),teleport:[String,Object],wordBreak:String,className:R,iconPrefix:String,transition:T("van-fade"),loadingType:String,forbidClick:Boolean,overlayClass:R,overlayStyle:Object,closeOnClick:Boolean,closeOnClickOverlay:Boolean,zIndex:p};var pe=j({name:wt,props:kt,emits:["update:show"],setup(e,{emit:t,slots:n}){let s,o=!1;const l=()=>{const f=e.show&&e.forbidClick;o!==f&&(o=f,gt(o))},c=f=>t("update:show",f),d=()=>{e.closeOnClick&&c(!1)},k=()=>clearTimeout(s),w=()=>{const{icon:f,type:g,iconSize:r,iconPrefix:a,loadingType:C}=e;if(f||g==="success"||g==="fail")return i(ke,{name:f||g,size:r,class:E("icon"),classPrefix:a},null);if(g==="loading")return i(Be,{class:E("loading"),size:r,type:C},null)},h=()=>{const{type:f,message:g}=e;if(n.message)return i("div",{class:E("text")},[n.message()]);if(J(g)&&g!=="")return f==="html"?i("div",{key:0,class:E("text"),innerHTML:String(g)},null):i("div",{class:E("text")},[g])};return A(()=>[e.show,e.forbidClick],l),A(()=>[e.show,e.type,e.message,e.duration],()=>{k(),e.show&&e.duration>0&&(s=setTimeout(()=>{c(!1)},e.duration))}),we(l),He(l),()=>i(xe,M({class:[E([e.position,e.wordBreak==="normal"?"break-normal":e.wordBreak,{[e.type]:!e.icon}]),e.className],lockScroll:!1,onClick:d,onClosed:k,"onUpdate:show":c},be(e,Ct)),{default:()=>[w(),h()]})}});function bt(){const e=Oe({show:!1}),t=o=>{e.show=o},n=o=>{D(e,o,{transitionAppear:!0}),t(!0)},s=()=>t(!1);return ge({open:n,close:s,toggle:t}),{open:n,close:s,state:e,toggle:t}}function Bt(e){const t=je(e),n=document.createElement("div");return document.body.appendChild(n),{instance:t.mount(n),unmount(){t.unmount(),document.body.removeChild(n)}}}const Ot={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let K=[],St=!1,ce=D({},Ot);const It=new Map;function xt(e){return Ye(e)?e:{message:e}}function pt(){const{instance:e,unmount:t}=Bt({setup(){const n=m(""),{open:s,state:o,close:l,toggle:c}=bt(),d=()=>{},k=()=>i(pe,M(o,{onClosed:d,"onUpdate:show":c}),null);return A(n,w=>{o.message=w}),de().render=k,{open:s,close:l,message:n}}});return e}function Pt(){if(!K.length||St){const e=pt();K.push(e)}return K[K.length-1]}function F(e={}){if(!Ve)return{};const t=Pt(),n=xt(e);return t.open(D({},ce,It.get(n.type||ce.type),n)),t}V(pe);const[Tt,B,H]=U("dialog"),_t=D({},W,{title:String,theme:String,width:p,message:[String,Function],callback:Function,allowHtml:Boolean,className:R,transition:T("van-dialog-bounce"),messageAlign:String,closeOnPopstate:I,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:I,closeOnClickOverlay:Boolean,keyboardEnabled:I}),Et=[...lt,"transition","closeOnPopstate"];var At=j({name:Tt,props:_t,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:t,slots:n}){const s=m(),o=Oe({confirm:!1,cancel:!1}),l=u=>t("update:show",u),c=u=>{var y;l(!1),(y=e.callback)==null||y.call(e,u)},d=u=>()=>{e.show&&(t(u),e.beforeClose?(o[u]=!0,Se(e.beforeClose,{args:[u],done(){c(u),o[u]=!1},canceled(){o[u]=!1}})):c(u))},k=d("cancel"),w=d("confirm"),h=Xe(u=>{var y,O;if(!e.keyboardEnabled||u.target!==((O=(y=s.value)==null?void 0:y.popupRef)==null?void 0:O.value))return;({Enter:e.showConfirmButton?w:G,Escape:e.showCancelButton?k:G})[u.key](),t("keydown",u)},["enter","esc"]),f=()=>{const u=n.title?n.title():e.title;if(u)return i("div",{class:B("header",{isolated:!e.message&&!n.default})},[u])},g=u=>{const{message:y,allowHtml:O,messageAlign:S}=e,P=B("message",{"has-title":u,[S]:S}),v=Ge(y)?y():y;return O&&typeof v=="string"?i("div",{class:P,innerHTML:v},null):i("div",{class:P},[v])},r=()=>{if(n.default)return i("div",{class:B("content")},[n.default()]);const{title:u,message:y,allowHtml:O}=e;if(y){const S=!!(u||n.title);return i("div",{key:O?1:0,class:B("content",{isolated:!S})},[g(S)])}},a=()=>i("div",{class:[Je,B("footer")]},[e.showCancelButton&&i(Z,{size:"large",text:e.cancelButtonText||H("cancel"),class:B("cancel"),style:{color:e.cancelButtonColor},loading:o.cancel,disabled:e.cancelButtonDisabled,onClick:k},null),e.showConfirmButton&&i(Z,{size:"large",text:e.confirmButtonText||H("confirm"),class:[B("confirm"),{[Ze]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:o.confirm,disabled:e.confirmButtonDisabled,onClick:w},null)]),C=()=>i(We,{class:B("footer")},{default:()=>[e.showCancelButton&&i(te,{type:"warning",text:e.cancelButtonText||H("cancel"),class:B("cancel"),color:e.cancelButtonColor,loading:o.cancel,disabled:e.cancelButtonDisabled,onClick:k},null),e.showConfirmButton&&i(te,{type:"danger",text:e.confirmButtonText||H("confirm"),class:B("confirm"),color:e.confirmButtonColor,loading:o.confirm,disabled:e.confirmButtonDisabled,onClick:w},null)]}),b=()=>n.footer?n.footer():e.theme==="round-button"?C():a();return()=>{const{width:u,title:y,theme:O,message:S,className:P}=e;return i(xe,M({ref:s,role:"dialog",class:[B([O]),P],style:{width:qe(u)},tabindex:0,"aria-labelledby":y||S,onKeydown:h,"onUpdate:show":l},be(e,Et)),{default:()=>[f(),r(),b()]})}}});const Dt=V(At);async function Pe(e,t={},n){return window.__TAURI_INTERNALS__.invoke(e,t,n)}async function zt(e){return await Pe("plugin:update|install",{payload:{value:e}}).then(t=>t.value?t.value:null)}async function ie(e,t,n){return await Pe("plugin:update|download",{payload:{url:e,name:t,external:n}}).then(s=>({message:s.message,filePath:s.filePath}))}const Lt=["href"],Nt={style:{width:"100%"}},Rt={__name:"DownloadLink",props:{href:{type:String,required:!0},download:{type:Boolean,default:!0}},setup(e){const t=m(!1),n=e,s=m(""),o=m(""),l=m(!1),c=m("下载中..."),d=m(n.href.endsWith(".apk")),k=m(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),w=r=>{location.search.indexOf("tauri")>-1&&k.value&&(console.log("点击",r.target.href),n.download&&(r.preventDefault(),s.value=r.target.href,o.value=r.target.href.split("/").pop(),t.value=!0))},h=r=>{l.value=!0,console.log("下载 ",s.value,o.value,r),ie(s.value,o.value,r).then(a=>{console.log("下载结果",JSON.stringify(a)),l.value=!1,F("下载成功")}).catch(a=>{l.value=!1,console.log("下载失败",a),F("下载失败")}),t.value=!1},f=()=>{t.value=!1},g=()=>{console.log("下载并安装",s.value,o.value);let r="false";l.value=!0,console.log("下载 ",s.value,o.value,r),ie(s.value,o.value,r).then(a=>{console.log("下载结果",a),a.filePath?(c.value="安装中...",zt(a.filePath).then(C=>{console.log("安装结果",C),l.value=!1}).catch(C=>{console.log("安装失败",C),l.value=!1,F("安装失败")})):(console.log("下载成功",a),l.value=!1,F("下载成功"))}).catch(a=>{console.log("下载失败",a),l.value=!1})};return(r,a)=>{const C=Be,b=Z,u=Dt;return X(),et(Ce,null,[q("a",{href:e.href,onClick:w,class:"download-link"},[tt(r.$slots,"default",{},void 0,!0)],8,Lt),i(u,{show:t.value,"onUpdate:show":a[2]||(a[2]=y=>t.value=y),title:"下载文件","show-cancel-button":!1,"show-confirm-button":!1},{default:_(()=>[q("div",Nt,[a[7]||(a[7]=q("p",null,"选择下载到内部还是外部？",-1)),l.value?(X(),ne(C,{key:0,size:"24px",vertical:""},{default:_(()=>[z(nt(c.value),1)]),_:1})):oe("",!0),i(b,{type:"primary",onClick:a[0]||(a[0]=y=>h("false"))},{default:_(()=>a[3]||(a[3]=[z("内部")])),_:1}),i(b,{type:"primary",onClick:a[1]||(a[1]=y=>h("true"))},{default:_(()=>a[4]||(a[4]=[z("外部")])),_:1}),d.value?(X(),ne(b,{key:1,type:"primary",onClick:g},{default:_(()=>a[5]||(a[5]=[z("下载并安装")])),_:1})):oe("",!0),i(b,{type:"default",onClick:f},{default:_(()=>a[6]||(a[6]=[z("取消")])),_:1})])]),_:1},8,["show"])],64)}}},$t=Qe(Rt,[["__scopeId","data-v-499e2181"]]);export{$t as _};
