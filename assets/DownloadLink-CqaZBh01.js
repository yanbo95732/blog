import{an as _e,ao as Z,Y as x,ap as M,X as p,aq as Ee,ar as ce,B as Ae,t as A,as as De,al as re,a as k,af as ue,q as U,V as j,ak as de,f as i,at as fe,au as ve,a2 as z,av as ze,aw as W,S as me,ax as ye,a7 as D,a1 as V,c as Le,ay as ge,b as he,az as Ne,F as we,ai as T,E as Re,aA as Me,a9 as Ce,p as $e,aB as He,ah as Ke,o as Fe,aC as ke,aD as be,aE as Ue,r as Be,aF as je,aG as Ve,aH as qe,$ as Ge,aI as Ye,aJ as ee,aK as Ze,aL as J,aM as Je,a0 as We,O as Xe,d as Qe,g as G,e as Y,x as en,w as _,H as ne,I as te,h as L,L as nn}from"./index-Ms05LE7_.js";import{u as tn}from"./use-touch-CxKhkrQz.js";function Oe(e,{args:n=[],done:t,canceled:l,error:o}){if(e){const s=e.apply(null,n);_e(s)?s.then(d=>{d?t():l&&l()}).catch(o||Z):s?t():l&&l()}else t()}let on=2e3;const an=()=>++on,X={show:Boolean,zIndex:p,overlay:x,duration:p,teleport:[String,Object],lockScroll:x,lazyRender:x,beforeClose:Function,overlayStyle:Object,overlayClass:M,transitionAppear:Boolean,closeOnClickOverlay:x},ln=Object.keys(X);let N=0;const oe="van-overflow-hidden";function sn(e,n){const t=tn(),l="01",o="10",s=w=>{t.move(w);const v=t.deltaY.value>0?o:l,g=De(w.target,e.value),{scrollHeight:u,offsetHeight:a,scrollTop:C}=g;let h="11";C===0?h=a>=u?"00":"01":C+a>=u&&(h="10"),h!=="11"&&t.isVertical()&&!(parseInt(h,2)&parseInt(v,2))&&re(w,!0)},d=()=>{document.addEventListener("touchstart",t.start),document.addEventListener("touchmove",s,{passive:!1}),N||document.body.classList.add(oe),N++},r=()=>{N&&(document.removeEventListener("touchstart",t.start),document.removeEventListener("touchmove",s),N--,N||document.body.classList.remove(oe))},y=()=>n()&&d(),b=()=>n()&&r();Ee(y),ce(b),Ae(b),A(n,w=>{w?d():r()})}function Se(e){const n=k(!1);return A(e,t=>{t&&(n.value=t)},{immediate:!0}),t=>()=>n.value?t():null}const ae=()=>{var e;const{scopeId:n}=((e=ue())==null?void 0:e.vnode)||{};return n?{[n]:""}:null},[cn,rn]=j("overlay"),un={show:Boolean,zIndex:p,duration:p,className:M,lockScroll:x,lazyRender:x,customStyle:Object,teleport:[String,Object]};var dn=U({name:cn,inheritAttrs:!1,props:un,setup(e,{attrs:n,slots:t}){const l=k(),o=Se(()=>e.show||!e.lazyRender),s=r=>{e.lockScroll&&re(r,!0)},d=o(()=>{var r;const y=z(ze(e.zIndex),e.customStyle);return W(e.duration)&&(y.animationDuration=`${e.duration}s`),me(i("div",D({ref:l,style:y,class:[rn(),e.className]},n),[(r=t.default)==null?void 0:r.call(t)]),[[ye,e.show]])});return de("touchmove",s,{target:l}),()=>{const r=i(fe,{name:"van-fade",appear:!0},{default:d});return e.teleport?i(ve,{to:e.teleport},{default:()=>[r]}):r}}});const fn=V(dn),vn=z({},X,{round:Boolean,position:T("center"),closeIcon:T("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:T("top-right"),destroyOnClose:Boolean,safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[mn,le]=j("popup");var yn=U({name:mn,inheritAttrs:!1,props:vn,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:n,attrs:t,slots:l}){let o,s;const d=k(),r=k(),y=Se(()=>e.show||!e.lazyRender),b=Le(()=>{const f={zIndex:d.value};if(W(e.duration)){const I=e.position==="center"?"animationDuration":"transitionDuration";f[I]=`${e.duration}s`}return f}),w=()=>{o||(o=!0,d.value=e.zIndex!==void 0?+e.zIndex:an(),n("open"))},v=()=>{o&&Oe(e.beforeClose,{done(){o=!1,n("close"),n("update:show",!1)}})},g=f=>{n("clickOverlay",f),e.closeOnClickOverlay&&v()},u=()=>{if(e.overlay)return i(fn,D({show:e.show,class:e.overlayClass,zIndex:d.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},ae(),{onClick:g}),{default:l["overlay-content"]})},a=f=>{n("clickCloseIcon",f),v()},C=()=>{if(e.closeable)return i(Ce,{role:"button",tabindex:0,name:e.closeIcon,class:[le("close-icon",e.closeIconPosition),Me],classPrefix:e.iconPrefix,onClick:a},null)};let h;const c=()=>{h&&clearTimeout(h),h=setTimeout(()=>{n("opened")})},m=()=>n("closed"),O=f=>n("keydown",f),S=y(()=>{var f;const{destroyOnClose:I,round:q,position:$,safeAreaInsetTop:Pe,safeAreaInsetBottom:Te,show:Q}=e;if(!(!Q&&I))return me(i("div",D({ref:r,style:b.value,role:"dialog",tabindex:0,class:[le({round:q,[$]:$}),{"van-safe-area-top":Pe,"van-safe-area-bottom":Te}],onKeydown:O},t,ae()),[(f=l.default)==null?void 0:f.call(l),C()]),[[ye,Q]])}),P=()=>{const{position:f,transition:I,transitionAppear:q}=e,$=f==="center"?"van-fade":`van-popup-slide-${f}`;return i(fe,{name:I||$,appear:q,onAfterEnter:c,onAfterLeave:m},{default:S})};return A(()=>e.show,f=>{f&&!o&&(w(),t.tabindex===0&&Re(()=>{var I;(I=r.value)==null||I.focus()})),!f&&o&&(o=!1,n("close"))}),ge({popupRef:r}),sn(r,()=>e.show&&e.lockScroll),de("popstate",()=>{e.closeOnPopstate&&(v(),s=!1)}),he(()=>{e.show&&w()}),Ne(()=>{s&&(n("update:show",!0),s=!1)}),ce(()=>{e.show&&e.teleport&&(v(),s=!0)}),$e(He,()=>e.show),()=>e.teleport?i(ve,{to:e.teleport},{default:()=>[u(),P()]}):i(we,null,[u(),P()])}});const xe=V(yn);let R=0;function gn(e){e?(R||document.body.classList.add("van-toast--unclickable"),R++):R&&(R--,R||document.body.classList.remove("van-toast--unclickable"))}const[hn,E]=j("toast"),wn=["show","overlay","teleport","transition","overlayClass","overlayStyle","closeOnClickOverlay","zIndex"],Cn={icon:String,show:Boolean,type:T("text"),overlay:Boolean,message:p,iconSize:p,duration:Ke(2e3),position:T("middle"),teleport:[String,Object],wordBreak:String,className:M,iconPrefix:String,transition:T("van-fade"),loadingType:String,forbidClick:Boolean,overlayClass:M,overlayStyle:Object,closeOnClick:Boolean,closeOnClickOverlay:Boolean,zIndex:p};var Ie=U({name:hn,props:Cn,emits:["update:show"],setup(e,{emit:n,slots:t}){let l,o=!1;const s=()=>{const v=e.show&&e.forbidClick;o!==v&&(o=v,gn(o))},d=v=>n("update:show",v),r=()=>{e.closeOnClick&&d(!1)},y=()=>clearTimeout(l),b=()=>{const{icon:v,type:g,iconSize:u,iconPrefix:a,loadingType:C}=e;if(v||g==="success"||g==="fail")return i(Ce,{name:v||g,size:u,class:E("icon"),classPrefix:a},null);if(g==="loading")return i(be,{class:E("loading"),size:u,type:C},null)},w=()=>{const{type:v,message:g}=e;if(t.message)return i("div",{class:E("text")},[t.message()]);if(W(g)&&g!=="")return v==="html"?i("div",{key:0,class:E("text"),innerHTML:String(g)},null):i("div",{class:E("text")},[g])};return A(()=>[e.show,e.forbidClick],s),A(()=>[e.show,e.type,e.message,e.duration],()=>{y(),e.show&&e.duration>0&&(l=setTimeout(()=>{d(!1)},e.duration))}),he(s),Fe(s),()=>i(xe,D({class:[E([e.position,e.wordBreak==="normal"?"break-normal":e.wordBreak,{[e.type]:!e.icon}]),e.className],lockScroll:!1,onClick:r,onClosed:y,"onUpdate:show":d},ke(e,wn)),{default:()=>[b(),w()]})}});function kn(){const e=Be({show:!1}),n=o=>{e.show=o},t=o=>{z(e,o,{transitionAppear:!0}),n(!0)},l=()=>n(!1);return ge({open:t,close:l,toggle:n}),{open:t,close:l,state:e,toggle:n}}function bn(e){const n=Ue(e),t=document.createElement("div");return document.body.appendChild(t),{instance:n.mount(t),unmount(){n.unmount(),document.body.removeChild(t)}}}const Bn={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let H=[],On=!1,se=z({},Bn);const Sn=new Map;function xn(e){return Ve(e)?e:{message:e}}function In(){const{instance:e}=bn({setup(){const n=k(""),{open:t,state:l,close:o,toggle:s}=kn(),d=()=>{},r=()=>i(Ie,D(l,{onClosed:d,"onUpdate:show":s}),null);return A(n,y=>{l.message=y}),ue().render=r,{open:t,close:o,message:n}}});return e}function pn(){if(!H.length||On){const e=In();H.push(e)}return H[H.length-1]}function K(e={}){if(!je)return{};const n=pn(),t=xn(e);return n.open(z({},se,Sn.get(t.type||se.type),t)),n}V(Ie);const[Pn,B,F]=j("dialog"),Tn=z({},X,{title:String,theme:String,width:p,message:[String,Function],callback:Function,allowHtml:Boolean,className:M,transition:T("van-dialog-bounce"),messageAlign:String,closeOnPopstate:x,showCancelButton:Boolean,cancelButtonText:String,cancelButtonColor:String,cancelButtonDisabled:Boolean,confirmButtonText:String,confirmButtonColor:String,confirmButtonDisabled:Boolean,showConfirmButton:x,closeOnClickOverlay:Boolean,keyboardEnabled:x,destroyOnClose:Boolean}),_n=[...ln,"transition","closeOnPopstate","destroyOnClose"];var En=U({name:Pn,props:Tn,emits:["confirm","cancel","keydown","update:show"],setup(e,{emit:n,slots:t}){const l=k(),o=Be({confirm:!1,cancel:!1}),s=c=>n("update:show",c),d=c=>{var m;s(!1),(m=e.callback)==null||m.call(e,c)},r=c=>()=>{e.show&&(n(c),e.beforeClose?(o[c]=!0,Oe(e.beforeClose,{args:[c],done(){d(c),o[c]=!1},canceled(){o[c]=!1}})):d(c))},y=r("cancel"),b=r("confirm"),w=qe(c=>{var m,O;if(!e.keyboardEnabled||c.target!==((O=(m=l.value)==null?void 0:m.popupRef)==null?void 0:O.value))return;({Enter:e.showConfirmButton?b:Z,Escape:e.showCancelButton?y:Z})[c.key](),n("keydown",c)},["enter","esc"]),v=()=>{const c=t.title?t.title():e.title;if(c)return i("div",{class:B("header",{isolated:!e.message&&!t.default})},[c])},g=c=>{const{message:m,allowHtml:O,messageAlign:S}=e,P=B("message",{"has-title":c,[S]:S}),f=Ye(m)?m():m;return O&&typeof f=="string"?i("div",{class:P,innerHTML:f},null):i("div",{class:P},[f])},u=()=>{if(t.default)return i("div",{class:B("content")},[t.default()]);const{title:c,message:m,allowHtml:O}=e;if(m){const S=!!(c||t.title);return i("div",{key:O?1:0,class:B("content",{isolated:!S})},[g(S)])}},a=()=>i("div",{class:[We,B("footer")]},[e.showCancelButton&&i(J,{size:"large",text:e.cancelButtonText||F("cancel"),class:B("cancel"),style:{color:e.cancelButtonColor},loading:o.cancel,disabled:e.cancelButtonDisabled,onClick:y},null),e.showConfirmButton&&i(J,{size:"large",text:e.confirmButtonText||F("confirm"),class:[B("confirm"),{[Je]:e.showCancelButton}],style:{color:e.confirmButtonColor},loading:o.confirm,disabled:e.confirmButtonDisabled,onClick:b},null)]),C=()=>i(Ze,{class:B("footer")},{default:()=>[e.showCancelButton&&i(ee,{type:"warning",text:e.cancelButtonText||F("cancel"),class:B("cancel"),color:e.cancelButtonColor,loading:o.cancel,disabled:e.cancelButtonDisabled,onClick:y},null),e.showConfirmButton&&i(ee,{type:"danger",text:e.confirmButtonText||F("confirm"),class:B("confirm"),color:e.confirmButtonColor,loading:o.confirm,disabled:e.confirmButtonDisabled,onClick:b},null)]}),h=()=>t.footer?t.footer():e.theme==="round-button"?C():a();return()=>{const{width:c,title:m,theme:O,message:S,className:P}=e;return i(xe,D({ref:l,role:"dialog",class:[B([O]),P],style:{width:Ge(c)},tabindex:0,"aria-labelledby":m||S,onKeydown:w,"onUpdate:show":s},ke(e,_n)),{default:()=>[v(),u(),h()]})}}});const An=V(En);async function pe(e,n={},t){return window.__TAURI_INTERNALS__.invoke(e,n,t)}async function Dn(e){return await pe("plugin:update|install",{payload:{value:e}}).then(n=>n.value?n.value:null)}async function ie(e,n,t){return await pe("plugin:update|download",{payload:{url:e,name:n,external:t}}).then(l=>({message:l.message,filePath:l.filePath}))}const zn=["href"],Ln={style:{width:"100%"}},Nn={__name:"DownloadLink",props:{href:{type:String,required:!0},download:{type:Boolean,default:!0}},setup(e){const n=k(!1),t=e,l=k(""),o=k(""),s=k(!1),d=k("下载中..."),r=k(t.href.endsWith(".apk")),y=k(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)),b=u=>{location.search.indexOf("tauri")>-1&&y.value&&(console.log("点击",u.target.href),t.download&&(u.preventDefault(),l.value=u.target.href,o.value=u.target.href.split("/").pop(),n.value=!0))},w=u=>{s.value=!0,console.log("下载 ",l.value,o.value,u),ie(l.value,o.value,u).then(a=>{console.log("下载结果",JSON.stringify(a)),s.value=!1,K("下载成功")}).catch(a=>{s.value=!1,console.log("下载失败",a),K("下载失败")}),n.value=!1},v=()=>{n.value=!1},g=()=>{console.log("下载并安装",l.value,o.value);let u="false";s.value=!0,console.log("下载 ",l.value,o.value,u),ie(l.value,o.value,u).then(a=>{console.log("下载结果",a),a.filePath?(d.value="安装中...",Dn(a.filePath).then(C=>{console.log("安装结果",C),s.value=!1}).catch(C=>{console.log("安装失败",C),s.value=!1,K("安装失败")})):(console.log("下载成功",a),s.value=!1,K("下载成功"))}).catch(a=>{console.log("下载失败",a),s.value=!1})};return(u,a)=>{const C=be,h=J,c=An;return G(),Qe(we,null,[Y("a",{href:e.href,onClick:b,class:"download-link"},[en(u.$slots,"default",{},void 0,!0)],8,zn),i(c,{show:n.value,"onUpdate:show":a[2]||(a[2]=m=>n.value=m),title:"下载文件","show-cancel-button":!1,"show-confirm-button":!1},{default:_(()=>[Y("div",Ln,[a[7]||(a[7]=Y("p",null,"选择下载到内部还是外部？",-1)),s.value?(G(),ne(C,{key:0,size:"24px",vertical:""},{default:_(()=>[L(nn(d.value),1)]),_:1})):te("",!0),i(h,{type:"primary",onClick:a[0]||(a[0]=m=>w("false"))},{default:_(()=>a[3]||(a[3]=[L("内部")])),_:1}),i(h,{type:"primary",onClick:a[1]||(a[1]=m=>w("true"))},{default:_(()=>a[4]||(a[4]=[L("外部")])),_:1}),r.value?(G(),ne(h,{key:1,type:"primary",onClick:g},{default:_(()=>a[5]||(a[5]=[L("下载并安装")])),_:1})):te("",!0),i(h,{type:"default",onClick:v},{default:_(()=>a[6]||(a[6]=[L("取消")])),_:1})])]),_:1},8,["show"])],64)}}},$n=Xe(Nn,[["__scopeId","data-v-499e2181"]]);export{$n as _};
